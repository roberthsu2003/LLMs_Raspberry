# 權限操作教學 – 老師示範

本文件提供教師在課堂上示範 Linux 權限管理的完整步驟與說明，涵蓋基本概念、常用指令、符號式與八進位模式、以及實務練習。請依序在終端機執行以下指令，並逐一解說每一步的目的與結果。

---

## 1. 權限基礎概念

在 Linux 中，每個檔案與目錄都有三組權限：

| 類別   | 符號 | 說明                 |
|--------|------|----------------------|
| 所有者 | `u`  | 檔案的擁有者         |
| 群組   | `g`  | 與檔案同屬群組的使用者 |
| 其他人 | `o`  | 其餘所有使用者       |

每組權限由 **讀 (r)**、**寫 (w)**、**執行 (x)** 組成。`ls -l` 的第一欄即顯示這 9 個權限，例如 `-rwxr-xr--`。

---

## 2. 檢視檔案權限

```sh
# 建立測試檔案
touch demo.txt

# 顯示長格式資訊，觀察權限欄位
ls -l demo.txt
```

*說明*：`-rw-r--r--` 表示所有者可讀寫，群組與其他人只能讀取。

---

## 3. 符號式變更權限

### 3.1 增減單一權限

```sh
# 為所有者加入執行權限
chmod u+x demo.txt

# 移除群組的寫入權限
chmod g-w demo.txt

# 為其他人加入執行權限
chmod o+x demo.txt
```

### 3.2 同時變更多組權限

```sh
# 讓所有人都有執行權限，且保留原有的讀/寫
chmod a+x demo.txt
```

### 3.3 使用 `+`、`-`、`=` 完全設定

```sh
# 只保留所有者的全部權限，其他人無權限
chmod u=rwx,g=,o= demo.txt

# 設定為 644（常見檔案權限）
chmod 644 demo.txt
```

---

## 4. 八進位（數字）模式

每個權限組合可對應一個 3 位的八進位數字：

| 數字 | 權限 |
|------|------|
| 0    | ---  |
| 1    | --x  |
| 2    | -w-  |
| 3    | -wx  |
| 4    | r--  |
| 5    | r-x  |
| 6    | rw-  |
| 7    | rwx  |

```sh
# 設定所有者 rwx、群組 r-x、其他人 r--
chmod 754 demo.txt
```

---

## 5. 目錄的執行權限

目錄的 `x` 代表「可進入」(traverse) 權限，沒有 `x` 即使有讀權限也無法 `cd` 進去。

```sh
# 建立目錄並設定權限
mkdir secret_folder
chmod 700 secret_folder   # 只有所有者可進入

# 若要讓群組可列出內容但不可新增/刪除
chmod 750 secret_folder
```

---

## 6. 關鍵觀念解析：為何檔案的 `x` 權限無法決定刪除或改名？

這是一個**非常關鍵、也很容易讓學生誤會的觀念** 👍。教學時可以先給結論，再逐步拆解。

### ✅ 結論速記

> **檔案的 `x` 權限**：
>
> - ✔ **功能**：僅決定檔案是否可以被「執行」。
> - ❌ **無關**：無法決定檔案是否能被「改名」或「刪除」。
>
> 👉 **檔案的改名與刪除權限，看的不是檔案本身，而是其所在的「目錄」權限。**

---

### 一、「執行」權限對「檔案」的意義

檔案的 `x` (execute) 權限，例如 `-rwxr--r--` 中的 `x`，單純地**允許該檔案被當作程式來執行**。
這常見於：
- Shell 腳本 (`.sh`)
- 已編譯的二進位程式
- 系統工具

**範例：**
```bash
chmod +x hello.sh
./hello.sh   # 因為有 x 權限，所以可以執行
```

📌 **重點：檔案的 `x` 只影響「執行」，與刪除、改名無關。**

---

### 二、為何「改名、刪除」與檔案權限無關？

在 Linux 的檔案系統設計中：

> **檔名是儲存在「目錄」的資料結構裡，而不是儲存在檔案本身的 inode 中。**

因此，當你執行「改名」或「刪除」檔案時，系統實際上是在**修改該目錄的內容**（即檔案列表）。

---

### 三、改名／刪除操作真正依賴的權限

👉 **操作權限取決於「檔案所在的目錄」權限**

| 目錄權限 | `r` (read) | `w` (write) | `x` (execute) |
|---|---|---|---|
| **作用** | 列出目錄內檔案 (`ls`) | **建立、刪除、改名** | 進入該目錄 (`cd`) |

⚠️ **注意：只要使用者對某個目錄擁有 `w` 和 `x` 權限，他就可以刪除或改動該目錄下的任何檔案，即使該檔案的所有者不是他。**

---

### 四、教學實戰範例

#### 情境 1：檔案沒有 `x` 權限，但可以被刪除

- **檔案權限**：`-rw-r--r--` (note.txt)
- **目錄權限**：`drwxrwxr-x` (mydir)

➡️ **結果**：**可以**成功刪除 `note.txt`，因為 `mydir` 目錄具備 `w` 和 `x` 權限。

#### 情境 2：檔案有完整的 `rwx` 權限，卻不能被刪除

- **檔案權限**：`-rwxr-xr-x` (run.sh)
- **目錄權限**：`dr-xr-xr-x` (mydir)

➡️ **結果**：❌ **無法**刪除或改名 `run.sh`，因為 `mydir` 目錄缺少 `w` 權限。

#### 情境 3：最常見的學生誤解（考試陷阱）

學生將檔案權限設為最高：`chmod 777 run.sh`
但檔案所在的目錄權限為：`dr-xr-xr-x`

➡️ **結果**：**依然無法**刪除或改名，因為關鍵的目錄 `w` 權限不存在。

---

### 五、教學金句

> 🔑 **「檔案能不能被刪掉，不是看檔案本身，而是看它住的房子（目錄）有沒有允許你動工。」**

---

### 六、檔案 vs. 目錄權限對照表

| 權限對象 | `r` (讀) | `w` (寫) | `x` (執行) |
|---|---|---|---|
| **檔案** | 讀取內容 | 修改內容 | **作為程式執行** |
| **目錄** | 列出檔名 | 新增 / 刪除 / 改名 | 進入目錄 |

---

## 7. 改變檔案/目錄擁有者與群組

```sh
# 以 sudo 執行，將 demo.txt 的擁有者改為 pi，群組改為 staff
sudo chown pi:staff demo.txt

# 只改變群組
sudo chgrp developers demo.txt
```

*說明*：只有 root 或具 `sudo` 權限的使用者可以變更擁有者。

---

## 8. 進階範例：設定執行腳本的安全權限

```sh
# 建立腳本
cat <<'EOF' > backup.sh
#!/bin/bash
echo "開始備份..."
# 假設的備份指令
EOF

# 只允許擁有者執行，其他人只能讀取
chmod 744 backup.sh

# 檢查權限
ls -l backup.sh
```

---

## 9. 常見錯誤與排除

| 錯誤訊息                     | 可能原因                     | 解決方式                                 |
|------------------------------|------------------------------|------------------------------------------|
| `permission denied`          | 缺少執行權限或寫入權限      | 使用 `chmod +x file` 或 `chmod u+w file` |
| `cannot access` (在 `cd` 時) | 目錄缺少 `x` 權限            | `chmod u+x directory`                    |
| `Operation not permitted`   | 非 root 嘗試改變擁有者        | 前置 `sudo` 或取得相應權限              |

---

## 10. 小結

- `ls -l` → 觀察權限  
- `chmod` → 符號式或八進位修改  
- `chown` / `chgrp` → 變更擁有者與群組  
- 目錄的 `x` 權限決定能否「穿過」該目錄
- **目錄的 `w` + `x` 權限決定能否在其中「新增、刪除、改名」檔案**

在示範每個指令後，請讓學生自行在終端機練習，並即時檢查 `ls -l` 的變化，確保概念已內化。祝教學順利！
